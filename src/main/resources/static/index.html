<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Qu·∫£n l√Ω sinh vi√™n</title>
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
</head>
<body class="container mt-4">

<h3>DANH S√ÅCH SINH VI√äN</h3>

<input type="text" id="search" class="form-control mb-3"
       placeholder="T√¨m theo t√™n..." onkeyup="searchStudent()">

<table class="table table-bordered">
    <thead>
    <tr>
        <th>ID</th>
        <th>T√™n</th>
        <th>Email</th>
        <th>H√†nh ƒë·ªông</th>
    </tr>
    </thead>
    <tbody id="studentTable"></tbody>
</table>

<h4>Th√™m sinh vi√™n</h4>

<!-- ‚ùå KH√îNG C√ì INPUT ID -->
<input id="name" class="form-control mb-2" placeholder="T√™n sinh vi√™n">
<input id="email" class="form-control mb-2" placeholder="Email">

<button class="btn btn-primary" onclick="addStudent()">Th√™m</button>

<script>
const API = "http://localhost:8080/api/students";

// LOAD DANH S√ÅCH
function loadStudents() {
    fetch(API)
        .then(res => res.json())
        .then(data => {
            let html = "";
            data.forEach(s => {
                html += `
                <tr>
                    <td>${s.id}</td>
                    <td>${s.name}</td>
                    <td>${s.email}</td>
                    <td>
                        <button class="btn btn-danger btn-sm"
                            onclick="deleteStudent(${s.id})">X√≥a</button>
                    </td>
                </tr>`;
            });
            document.getElementById("studentTable").innerHTML = html;
        });
}

// ‚úÖ TH√äM SINH VI√äN (FORM ‚Üí @RequestParam)
function addStudent() {
    const name = document.getElementById("name").value;
    const email = document.getElementById("email").value;

    const formData = new URLSearchParams();
    formData.append("name", name);
    formData.append("email", email);

    fetch(API + "/add", {
        method: "POST",
        headers: {
            "Content-Type": "application/x-www-form-urlencoded"
        },
        body: formData.toString()
    })
    .then(() => {
        document.getElementById("name").value = "";
        document.getElementById("email").value = "";
        loadStudents();
    });
}

// ‚úÖ X√ìA SINH VI√äN
function deleteStudent(id) {
    fetch(API + "/delete/" + id, {
        method: "DELETE"
    }).then(() => loadStudents());
}

// üîç SEARCH
function searchStudent() {
    const name = document.getElementById("search").value;
    fetch(API + "/search?name=" + name)
        .then(res => res.json())
        .then(data => {
            let html = "";
            data.forEach(s => {
                html += `
                <tr>
                    <td>${s.id}</td>
                    <td>${s.name}</td>
                    <td>${s.email}</td>
                    <td></td>
                </tr>`;
            });
            document.getElementById("studentTable").innerHTML = html;
        });
}

loadStudents();
</script>

</body>
</html>
